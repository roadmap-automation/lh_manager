<head>
    <script src="https://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script>

        methoddata = {}
        zones = {}

        function make_form() {
            //var key = $("#method_select").options[$("#method_select").selectedIndex]
            $('#auto_form').empty()
            var key = $("#method_select :selected").text()
            console.log(key)
            console.log(methoddata)
            for (const field of methoddata[key]) {
                console.log(field)
                var lbl = $("<label>").text(field)
                if (field.includes('Zone')) {
                    newsel = $("<select>").attr({
                        name: field,
                        tag: 'form_element'
                        }).appendTo(lbl)
                    for (const zone of zones) {
                        $("<option>").text(zone).appendTo(newsel)
                    }
                }
                else {
                    
                    $("<input>").attr({
                        name: field,
                        tag: 'form_element',
                        value: "0"
                        }).appendTo(lbl)
                }
                $("<br>").appendTo(lbl)
                lbl.appendTo('#auto_form')
            }
        }

        function send_sample() {
            var data = {}
            var key = $("#method_select :selected").text()
            $('*[tag=form_element]').each(function() {
                data[this.name] = this.value
            })
            data['METHODNAME'] = key
            fetch('/test/AddSample', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json; charset=UTF-8'
                },
                body: JSON.stringify(data),
                })
                .then(function (response) {
                    return response.json()            
                }).then(function (return_data) {
                    console.log(return_data)
                })
        }

        window.onload = function() {
            fetch('/GUI/GetLHMethods/')
                .then(function (response) {
                    return response.json();
                }).then(function (text) {
                    form = document.getElementById("form")
                    console.log(text['methods'])
                    console.log(Object.keys(text['methods']))
                    
                    for (const k of Object.keys(text['methods'])) {
                        console.log(k)
                        option = document.createElement("option")
                        option.text = k
                        $("#method_select").append(option)
                    }
                    methoddata = text['methods']
                    zones = text['enums']['Zone']
                });
        }
    </script>
</head>
<body>
    <div id="form">
        <select id="method_select"></select>
        <button id="make_form" onclick="make_form()">Make form</button>
        <div id="auto_form"></div>
        <button id="send_sample" onclick="send_sample()">Send Sample</button>
    </div>
</body>